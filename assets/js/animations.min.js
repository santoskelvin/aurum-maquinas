(function() {
  'use strict';
  
  // DESABILITAR COMPLETAMENTE NO MOBILE para evitar interferência com scroll nativo
  if (window.innerWidth <= 768) {
    console.log('GSAP animations disabled on mobile for better scroll performance');
    return;
  }
  
  // Registrar ScrollTrigger se disponível
  if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
    gsap.registerPlugin(ScrollTrigger);
  }
  
  // Respeitar preferência de movimento reduzido
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  
  // Função simplificada de animação
  function animateSection(section, elements, stagger) {
    if (!section || !elements || elements.length === 0) return;
    
    gsap.fromTo(elements, {
      opacity: 0,
      y: 20
    }, {
      scrollTrigger: {
        trigger: section,
        start: 'top 95%',
        once: true,
        // Configurações otimizadas para não interferir com scroll
        markers: false,
        scrub: false,
        pin: false,
        anticipatePin: 0
      },
      opacity: 1,
      y: 0,
      duration: 0.5,
      ease: 'power2.out',
      stagger: stagger || 0
    });
  }
  
  function initAnimations() {
    if (typeof gsap === 'undefined') return;
    
    // How It Works
    const s1 = document.querySelector('.how-it-works');
    if (s1) {
      const header = s1.querySelector('.how-it-works-header');
      const illustration = s1.querySelector('.how-it-works-illustration');
      const steps = s1.querySelectorAll('.step-item');
      
      if (header) {
        const label = header.querySelector('.how-it-works-label');
        const title = header.querySelector('.how-it-works-title');
        const subtitle = header.querySelector('.how-it-works-subtitle');
        if (label) animateSection(s1, [label]);
        if (title) animateSection(s1, [title]);
        if (subtitle) animateSection(s1, [subtitle]);
      }
      if (illustration) animateSection(s1, [illustration]);
      if (steps.length) animateSection(s1, steps, 0.1);
    }
    
    // Rentabilidade
    const s2 = document.querySelector('.rentabilidade-section');
    if (s2) {
      const header = s2.querySelector('.rentabilidade-header');
      const cards = s2.querySelectorAll('.chart-card');
      
      if (header) {
        const label = header.querySelector('.rentabilidade-label');
        const title = header.querySelector('.rentabilidade-title');
        const desc = header.querySelector('.rentabilidade-description');
        if (label) animateSection(s2, [label]);
        if (title) animateSection(s2, [title]);
        if (desc) animateSection(s2, [desc]);
      }
      if (cards.length) animateSection(s2, cards, 0.1);
    }
    
    // Aurum Patrimonial
    const s3 = document.querySelector('.aurum-patrimonial');
    if (s3) {
      const card = s3.querySelector('.aurum-patrimonial-card');
      const gridCards = s3.querySelectorAll('.aurum-card');
      
      if (card) animateSection(s3, [card]);
      if (gridCards.length) animateSection(s3, gridCards, 0.1);
    }
    
    // Micro Calc
    const s4 = document.querySelector('.micro-calc-section');
    if (s4) {
      const copy = s4.querySelector('.micro-calc-copy');
      const form = s4.querySelector('.micro-calc-card');
      
      if (copy) {
        const label = copy.querySelector('.micro-calc-label');
        const title = copy.querySelector('.micro-calc-title');
        const text = copy.querySelector('.micro-calc-text');
        if (label) animateSection(s4, [label]);
        if (title) animateSection(s4, [title]);
        if (text) animateSection(s4, [text]);
      }
      if (form) animateSection(s4, [form]);
    }
    
    // Passo a Passo
    const s5 = document.querySelector('.passo-a-passo-section');
    if (s5) {
      const header = s5.querySelector('.passo-a-passo-header');
      const cards = s5.querySelectorAll('.passo-card');
      
      if (header) {
        const label = header.querySelector('.passo-a-passo-label');
        const title = header.querySelector('.passo-a-passo-title');
        const subtitle = header.querySelector('.passo-a-passo-subtitle');
        if (label) animateSection(s5, [label]);
        if (title) animateSection(s5, [title]);
        if (subtitle) animateSection(s5, [subtitle]);
      }
      if (cards.length) animateSection(s5, cards, 0.1);
    }
  }
  
  // Inicializar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAnimations);
  } else {
    initAnimations();
  }
})();
